---6.1
 CREATE or REPLACE PROCEDURE wstaw_rezerwacje1_log (id_wycieczki1 in INT ,
   id_osoby1 IN INT)
 AS
osoba  INT;
wycieczka  INT;
ilosc  INT;
limit1 INT;
czas DATE;

BEGIN
  BEGIN
 SELECT   count(osoby.id_osoby)  into  osoba FROM  osoby
 where OSOBY.ID_OSOBY = id_osoby1;

    SELECT  count(wycieczki.id_wycieczki) into wycieczka from WYCIECZKI
    where WYCIECZKI.ID_WYCIECZKI = id_wycieczki1;

    select count(*) into ilosc  from rezerwacje
    where REZERWACJE.id_wycieczki = id_wycieczki1
          and REZERWACJE.STATUS != 'A';

    select count(*) into ilosc
    from rezerwacje
    where REZERWACJE.id_wycieczki = id_wycieczki1
          and REZERWACJE.STATUS != 'A';
  SELECT DATA into czas from WYCIECZKI
    WHERE  id_wycieczki1=WYCIECZKI.ID_WYCIECZKI;

    select LICZBA_MIEJSC  into limit1
    from WYCIECZKI where id_wycieczki1=ID_WYCIECZKI;
  END;

    if(osoba = 0)
  THEN
    raise_application_error (-20001, 'Nie ma osoby o takim  id ' , TRUE);
  END if;

if(wycieczka = 0 )
  THEN
    raise_application_error (-20001, 'Nie ma wycieczki o takim id' , TRUE);
    end if;


 if(ilosc + 1 <= limit1)
  THEN
   raise_application_error (-20001, 'Nie ma miejsc' , TRUE);
  END IF;

  if(CURRENT_TIMESTAMP>czas) then
     raise_application_error (-20001, 'Wycieczka juz sie odbyla' , TRUE);
  END IF;

  INSERT INTO rezerwacje(id_wycieczki, id_osoby, status)
VALUES (id_wycieczki1,id_osoby1,'N');


  BEGIN
  SELECT  MAX(REZERWACJE.NR_REZERWACJI) into rezerwacja from REZERWACJE
  order BY REZERWACJE.NR_REZERWACJI DESC;
END;

  INSERT INTO REZERWACJE_LOG(ID_REZERWACJI,DATA, STATUS)
    VALUES (rezerwacja,current_timestamp,'N');


END wstaw_rezerwacje1_log;




--6.2
CREATE or REPLACE PROCEDURE zmien_status_rezerwacji_log (id_rezerwacji1 in INT ,
   status1 IN CHAR)
 AS
   rezerwacja  INT;
BEGIN
  BEGIN
SELECT  count(REZERWACJE.NR_REZERWACJI) into rezerwacja from REZERWACJE
    where NR_REZERWACJI=id_rezerwacji1;
  END;
  if(rezerwacja = 0 )
  THEN
    raise_application_error (-20001, 'Nie ma wycieczki o takim id' , TRUE);
    end if;

  UPDATE REZERWACJE set STATUS=status1
  where id_rezerwacji1=NR_REZERWACJI;



  INSERT INTO REZERWACJE_LOG(ID_REZERWACJI,DATA, STATUS)
    VALUES (id_rezerwacji1,current_timestamp,'U');

END ;

